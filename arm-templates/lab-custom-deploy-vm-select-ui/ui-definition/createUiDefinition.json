{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "basics": [
            {}
        ],
        "steps": [
			{
				"name": "attendees",
				"label": "Attendees",
				"elements": [
					{
						"name": "numOfAttendeesStep",
						"type": "Microsoft.Common.Slider",
						"label": "Number of attendees",
						"subLabel": "attendees",
						"toolTip": "Number of attendees to the training.",
						"showStepMarkers": false,
						"min": 1,
						"max": 20,
						"defaultValue": 8,
						"constraints": {
							"required": true
						},
						"visible": true
					}
				]
			},
			{
				"name": "emulatedOnPremisesEnvStep",
				"label": "Emulated on-premises environment",
				"elements": [
					{
						"name": "isDeployEmulatedOnPremisesEnv",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Deploy the emulated on-premises environment?",
						"toolTip": "",
						"defaultValue": "Yes",
						"constraints": {
						  "allowedValues": [
							{
							  "label": "Yes",
							  "value": true
							},
							{
							  "label": "No",
							  "value": false
							}
						  ],
						  "required": true
						},
						"visible": true
					},
					{
						"name": "vpnSettingsSection",
						"type": "Microsoft.Common.Section",
						"label": "VPN settings",
						"elements": [
							{
								"name": "vpnSharedKey",
								"type": "Microsoft.Common.TextBox",
								"label": "Shared key (PSK)",
								"toolTip": "A mixture of letters and numbers, used to establish encryption for the connection. The same shared key must be used in both the virtual network and local network gateways. If your gateway device doesn't provide one, you can make one up here and provide it to your device.",
								"placeholder": "Your shared key",
								"defaultValue": "",
								"constraints": {
									"required": true
								},
								"visible": true
							}
						],
						"visible": "[steps('emulatedOnPremisesEnvStep').isDeployEmulatedOnPremisesEnv]"
					}
				]
			},
			{
				"name": "jumpboxVmStep",
				"label": "Jump-box VM",
				"elements": [
					{
						"name": "isDeployJumpboxVm",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Deploy a jump-box VM for each attendee?",
						"toolTip": "",
						"defaultValue": "Yes",
						"constraints": {
						  "allowedValues": [
							{
							  "label": "Yes",
							  "value": true
							},
							{
							  "label": "No",
							  "value": false
							}
						  ],
						  "required": true
						},
						"visible": true
					},
					{
						"name": "adminAccountSection",
						"type": "Microsoft.Common.Section",
						"label": "Administrator account",
						"elements": [
							{
								"name": "adminUserName",
								"type": "Microsoft.Compute.UserNameTextBox",
								"label": "Username",
								"toolTip": "",
								"defaultValue": "AzureAdmin",
								"constraints": {
									"required": true,
									"regex": "^[a-z0-9A-Z]{1,20}$",
									"validationMessage": "Only alphanumeric characters are allowed, and the value must be 1-20 characters long."
								},
								"osPlatform": "Windows",
								"visible": true
							},					
							{
								"name": "adminPassword",
								"type": "Microsoft.Compute.CredentialsCombo",
								"label": {
									"password": "Password",
									"confirmPassword": "Confirm password"
								},
								"toolTip": {
									"password": ""
								},
								"constraints": {
									"required": true,
									"customPasswordRegex": "^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d]{12,}$",
									"customValidationMessage": "The password must be alphanumeric, contain at least 12 characters, and have at least 1 letter and 1 number."
								},
								"options": {
									"hideConfirmation": false
								},
								"osPlatform": "Windows",
								"visible": true
							}
						],
						"visible": true
					},
					{
						"name": "vmSettingsSectoin",
						"type": "Microsoft.Common.Section",
						"label": "Virtual machine settings",
						"elements": [
							{
								"name": "jumpVmOsImage",
								"type": "Microsoft.Common.DropDown",
								"label": "OS image",
								"toolTip": "",
								"placeholder": "",
								"defaultValue": "Windows 10 Pro (127 GiB)",
								"constraints": {
									"allowedValues": [
										{
											"label": "Windows 10 Pro (127 GiB)",
											"value": "one"
										},
										{
											"label": "Windows Server 2019 Datacenter (127 GiB)",
											"value": "two"
										},
										{
											"label": "Windows Server 2019 Datacenter (30 GiB)",
											"value": "three"
										}
									],
									"required": true
								},
								"visible": true
							},
							{
								"name": "element1",
								"type": "Microsoft.Compute.SizeSelector",
								"label": "Size",
								"toolTip": "",
								"recommendedSizes": [
									"Standard_D1",
									"Standard_D2",
									"Standard_D3"
								],
								"constraints": {
									"allowedSizes": [],
									"excludedSizes": [],
									"numAvailabilityZonesRequired": 3,
									"zone": "3"
								},
								"options": {
									"hideDiskTypeFilter": false
								},
								"osPlatform": "Windows",
								"imageReference": {
									"publisher": "MicrosoftWindowsServer",
									"offer": "WindowsServer",
									"sku": "2012-R2-Datacenter"
								},
								"count": 2,
								"visible": true
							},
							{
								"name": "dropDown1",
								"type": "Microsoft.Common.DropDown",
								"label": "OS disk type",
								"toolTip": "",
								"placeholder": "",
								"defaultValue": "Value two",
								"constraints": {
									"allowedValues": [
										{
											"label": "Value one",
											"value": "one"
										},
										{
											"label": "Value two",
											"value": "two"
										}
									],
									"required": true
								},
								"visible": true
							}
						],
						"visible": true
					},
					{
						"name": "autoShutdownSection",
						"type": "Microsoft.Common.Section",
						"label": "Auto-shutdown",
						"elements": [
							{
								"name": "autoShutdownTime",
								"type": "Microsoft.Common.DropDown",
								"label": "Daily auto-shutdown time",
								"toolTip": "",
								"placeholder": "",
								"defaultValue": "Value two",
								"constraints": {
									"allowedValues": [
										{
											"label": "Value one",
											"value": "one"
										},
										{
											"label": "Value two",
											"value": "two"
										}
									],
									"required": true
								},
								"visible": true
							},
							{
								"name": "autoShutdownTimeZone",
								"type": "Microsoft.Common.DropDown",
								"label": "Auto-shutdown time zone",
								"toolTip": "",
								"placeholder": "",
								"defaultValue": "Value two",
								"constraints": {
									"allowedValues": [
										{
											"label": "Value one",
											"value": "one"
										},
										{
											"label": "Value two",
											"value": "two"
										}
									],
									"required": true
								},
								"visible": true
							}
						],
						"visible": true
            		}
				]
			},
            {
                "name": "tagsStep",
                "label": "Tags",
                "elements": [
                    {
                        "name": "tagsByResource",
                        "type": "Microsoft.Common.TagsByResource",
                        "resources": [
                            "Microsoft.Storage/storageAccounts",
                            "Microsoft.Compute/virtualMachines"
                        ]
                    }
                ]
            }
        ],
        "outputs": {
            "storageAccountNamePrefix": "[steps('storageConfig').storageAccounts.prefix]",
            "storageAccountType": "[steps('storageConfig').storageAccounts.type]",
            "location": "[location()]",
            "tagsByResource": "[steps('tags').tagsByResource]"
        }
    }
}
